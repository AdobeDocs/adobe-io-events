"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[1113],{84133:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return d},default:function(){return u}});var a,o=n(87462),i=n(63366),r=(n(15007),n(64983)),s=n(91515),l=["components"],d={},p=(a="InlineAlert",function(e){return console.warn("Component "+a+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",e)}),c={_frontmatter:d},m=s.Z;function u(e){var t=e.components,n=(0,i.Z)(e,l);return(0,r.mdx)(m,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"event-template-generator"},"Event Template Generator"),(0,r.mdx)("p",null,"The event template generator bootstraps the project code with a template that allows you to create a basic ",(0,r.mdx)("a",{parentName:"p",href:"https://cloudevents.io/"},"Cloud Event")," and publish that event to Adobe I/O Events. "),(0,r.mdx)("p",null,"This template can be used in conjunction with other action templates that are supported by the CLI such as Target, Analytics, and Campaign, as well as your own custom code. "),(0,r.mdx)("p",null,"To learn more, visit the ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/adobe/generator-aio-app/tree/master/generators/add-events"},"generator app public GitHub repository"),"."),(0,r.mdx)("h2",{id:"installation"},"Installation"),(0,r.mdx)("p",null,"Run the following command to install the CLI."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"npm install -g @adobe/aio-cli\n")),(0,r.mdx)("h2",{id:"getting-started"},"Getting Started"),(0,r.mdx)("p",null,"To bootstrap the project code, create a directory and run the following commands from that directory:"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"First, select the appropriate organization."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"➜  project aio app init\nRetrieving information from Adobe I/O Console..\n? Select Org\n  AAA-Alpha Org\n❯ Adobe IO DEMO\n  Beta Org \n  Delta Org\n"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Then, select the project from within that organization."),(0,r.mdx)("p",{parentName:"li"},"You can either select the project by scrolling or you can filter the list of projects by beginning to type the name of the project."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"➜  project aio app init\nRetrieving information from Adobe I/O Console..\n? Select Org Adobe IO DEMO\n? Select Project\n  service-account-test\n❯ sample-project-test\n  new-cli-test-project\n(Move up and down to reveal more choices)\n"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"From within the project, you must then select the appropriate workspace."),(0,r.mdx)("p",{parentName:"li"},"If you have followed the steps for ",(0,r.mdx)("a",{parentName:"p",href:"/adobe-io-events/developer-console/docs/guides/projects/projects-empty/"},"creating a new project"),", there will only be one workspace available: Production."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"➜  project aio app init\nRetrieving information from Adobe I/O Console..\n? Select Org Adobe IO DEMO\n? Select Project Sample Project\n? Select Workspace (Use arrow keys or type to search)\n❯ Production\n"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"You are then are presented with a series of choices for the project. This includes Actions, Events, Web Assets and CI/CD. "),(0,r.mdx)("p",{parentName:"li"},"If you want would like to have a UI to access your actions, select the Web Assets in addition to your action. "),(0,r.mdx)("p",{parentName:"li"},"By default, all options are selected. You can use the letter 'A' to toggle the selections and the space bar to select actions you wish to add to your project. For this example, only Events and Web Assets are selected."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"➜  project aio app init\nRetrieving information from Adobe I/O Console..\n? Select Org Adobe IO DEMO\n? Select Project Sample Project\n? Select Workspace Production\n  create console.json\n\nYou are about to initialize the project '{PROJECT_NAME_FROM_CONSOLE}'\nGenerating code in: /{PATH}\n? Which Adobe I/O App features do you want to enable for this project?\nselect components to include\n  ◯ Actions: Deploy Runtime actions\n  ◉ Events: Publish to Adobe I/O Events\n❯◉ Web Assets: Deploy hosted static assets\n  ◯ CI/CD: Include GitHub Actions based workflows for Build, Test and Deploy\n"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"You can then enter the name of the action you want to use for the events project (by default, ",(0,r.mdx)("inlineCode",{parentName:"p"},"publish-event")," will be used) and press enter. This triggers the creation of a project that contains the Events Template to publish ",(0,r.mdx)("a",{parentName:"p",href:"https://cloudevents.io"},"CloudEvents")," and Web Assets. "),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"You are about to initialize the project '{PROJECT_NAME_FROM_CONSOLE}'\nGenerating code in: /{PATH}\n? Which Adobe I/O App features do you want to enable for this project?\nselect components to include Events: Publish to Adobe I/O Events, Web Assets: Deploy hosted static assets\n? We are about to create a new sample action that creates messages in cloud events format and publishes to Adobe I/O Events\nhow would you like to name this action? (publish-events)\n  create package.json\n  create manifest.yml\n  create .aio\n  create README.md\n  create test/jest.setup.js\n  create .env\n  create .gitignore\n  create actions/publish-events/index.js\n  create test/actions/publish-events.test.js\n  create actions/utils.js\n  create test/actions/utils.test.js\n  create e2e/actions/publish-events.e2e.js\n  create web-src/404.html\n  create web-src/index.html\n  create web-src/src/App.css\n  create web-src/src/App.js\n  create web-src/src/exc-runtime.js\n  create web-src/src/index.js\n  create web-src/src/utils.js\n  create .babelrc\n....\nfound 0 vulnerabilities\n\n✔ App initialization finished!\n")))),(0,r.mdx)("h2",{id:"sample-project-structure"},"Sample Project Structure"),(0,r.mdx)("p",null,"The following diagram outlines a sample project structure, showing the files that were previously created and how they relate to other files in the project."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},".\n\n├── README.md\n\n├── node_modules\n\n├── actions\n\n│   ├── publish-events\n\n│   │   └── index.js (Source file that contains a template to create a publish Cloud Events to Adobe I/O Events.)\n\n│   └── utils.js\n\n├── console.json (Contains Adobe Developer Console credentials that include the org id, workspace id, project id, JWT token credentials, etc.) \n\n├── e2e\n\n│   └── actions\n\n│       └── publish-events.e2e.js\n\n├── manifest.yml\n\n├── .env (Contains the environment variables required to deploy your action in Adobe I/O Runtime, and other credentials required in order to invoke the Publish API.) \n\n├── package-lock.json\n\n├── package.json\n\n├── test\n\n│   ├── actions\n\n│   │   ├── publish-events.test.js (Test file for the events sample code.)\n\n│   │   └── utils.test.js\n\n│   └── jest.setup.js\n\n└── web-src\n\n    ├── ........\n\n        └── .......\n")),(0,r.mdx)("h2",{id:"deploying-the-action"},"Deploying the Action"),(0,r.mdx)("p",null,"From the same directory, begin by running the following command:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"aio app run\n")),(0,r.mdx)("p",null,"This command will create an action in Adobe I/O Runtime. "),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"➜  project aio app run\nsuccess: generated certificate\nA self signed development certificate has been generated, you will need to accept it in your browser in order to use it.\nWaiting for the certificate to be accepted.... done\nGreat, you accepted the certificate!\n> Local Dev Server\nℹ using remote actions\nℹ redeploying actions..\nℹ   -> XXX-0.0.1/__secured_publish-events\nℹ   -> https://xxx.adobeioruntime.net/api/v1/web/{PROJECT_NAME_FROM_CONSOLE}-0.0.1/publish-events\nℹ writing credentials to tmp wskdebug config '.wskdebug.props.tmp'..\nℹ injecting backend urls into frontend config\nℹ starting local frontend server ..\nℹ local frontend server running at https://localhost:9080\nℹ setting up vscode debug configuration files..\nℹ press CTRL+C to terminate dev environment\n⠋ Local Dev Server\nTo view your local application:\n  -> https://localhost:9080\nTo view your deployed application in the Experience Cloud shell:\n  -> https://experience.adobe.com/?devMode=true#/custom-apps/?localDevUrl=https://localhost:9080\n")),(0,r.mdx)("p",null,"You will also receive the action URL which can be invoked from your application or via a CuRL command as well as a link to a user interface (UI) in order to invoke your action."),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Action URL: ",(0,r.mdx)("inlineCode",{parentName:"li"},"https://XXX.adobeioruntime.net/api/v1/web/{PROJECT_NAME_FROM_CONSOLE}-0.0.1/publish-events")),(0,r.mdx)("li",{parentName:"ul"},"UI URL: ",(0,r.mdx)("inlineCode",{parentName:"li"},"https://experience.adobe.com/?devMode=true#/custom-apps/?localDevUrl=https://localhost:9080"))),(0,r.mdx)("h2",{id:"invoking-the-action"},"Invoking the Action"),(0,r.mdx)("p",null,"You can now invoke the action using the ",(0,r.mdx)("a",{parentName:"p",href:"#user-interface"},"UI")," or a ",(0,r.mdx)("a",{parentName:"p",href:"#curl-command"},"CuRL command")," by providing the following required headers and parameters:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("strong",{parentName:"p"},"Headers:")),(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Authorization:"),"  JWT Token that contains the ",(0,r.mdx)("inlineCode",{parentName:"li"},"adobeio_api"),' scope which can be obtained by adding the I/O Management API in the Adobe Developer Console. This token should be prepended with the word "Bearer". For more information, see the ',(0,r.mdx)("a",{parentName:"li",href:"/adobe-io-events/developer-console/docs/guides/authentication/ServiceAccountIntegration/"},"service account integration documentation"),"."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"x-gw-ims-org-id:")," The IMS Organization ID which can be obtained from the ",(0,r.mdx)("inlineCode",{parentName:"li"},"config.json")," file or in the Adobe Developer Console. "))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("strong",{parentName:"p"},"Parameters:")),(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"apiKey:")," The client ID from the integration, found in the Adobe Developer Console."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"providerId:")," The ID of the Provider for which the event is being published."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"eventCode:")," The type of event of the Provider."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"payload:")," The JSON Payload to be published.")))),(0,r.mdx)("h3",{id:"user-interface"},"User interface"),(0,r.mdx)("p",null,"Selecting the UI link opens a user interface similar to the image shown below. You can use the ",(0,r.mdx)("strong",{parentName:"p"},"select the action")," drop-down to choose the action to be invoked."),(0,r.mdx)("p",null,"For headers, you must pass a JSON Payload containing the ",(0,r.mdx)("inlineCode",{parentName:"p"},"Authorization")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"x-gw-ims-org-id")," headers. Use the following example for reference, being sure to substitute real values for the JWT token and IMS Org ID."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{ "Authorization":"Bearer <JWT_TOKEN>", "x-gw-ims-org-id":"<IMS_ORG_ID>" }\n')),(0,r.mdx)("p",null,"For params, you must pass a JSON object containing all of the required parameters, being sure to substitute real values for the placeholders shown."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{ "providerId":"<PROVIDER_ID>", "apiKey":"<CLIENT_ID>", "eventCode":"<EVENT_CODE>", "payload":{ "hello":"project" } }\n')),(0,r.mdx)("p",null,(0,r.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",(0,r.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"98.75%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,r.mdx)("picture",{parentName:"span"},"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/adobe-io-events/static/620c423b1d0e4ad9d080ed017170127d/5530d/template-action-ui.webp 320w","/adobe-io-events/static/620c423b1d0e4ad9d080ed017170127d/0c8fb/template-action-ui.webp 640w","/adobe-io-events/static/620c423b1d0e4ad9d080ed017170127d/e2c2f/template-action-ui.webp 1152w"],sizes:"(max-width: 1152px) 100vw, 1152px",type:"image/webp"}),"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/adobe-io-events/static/620c423b1d0e4ad9d080ed017170127d/dd4a7/template-action-ui.png 320w","/adobe-io-events/static/620c423b1d0e4ad9d080ed017170127d/0f09e/template-action-ui.png 640w","/adobe-io-events/static/620c423b1d0e4ad9d080ed017170127d/d2d74/template-action-ui.png 1152w"],sizes:"(max-width: 1152px) 100vw, 1152px",type:"image/png"}),"\n          ",(0,r.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/adobe-io-events/static/620c423b1d0e4ad9d080ed017170127d/d2d74/template-action-ui.png",alt:"template action ui",title:"template action ui",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,r.mdx)("p",null,"Once all of the required information has been provided, select ",(0,r.mdx)("strong",{parentName:"p"},"Invoke")," and the corresponding action is executed to convert the JSON payload into ",(0,r.mdx)("a",{parentName:"p",href:"https://cloudevents.io/"},"Cloud Event")," format and publish it to Adobe I/O Events. "),(0,r.mdx)("h3",{id:"curl-command"},"CuRL Command"),(0,r.mdx)("p",null,"The required headers are used as shown below and the parameters are passed as a JSON object in the body of the request."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},'curl -X POST \\\n  https://xxx.adobeioruntime.net/api/v1/web/{PROJECT_NAME_FROM_CONSOLE}-0.0.1/publish-events \\\n  -H \'Authorization: Bearer <JWT_TOKEN>\' \\\n  -H \'Content-Type: application/json\' \\\n  -H \'x-gw-ims-org-id: <ORG_ID>\' \\\n  -d \'{\n        "providerId":"<PROVIDER_ID>",\n        "apiKey":"<CLIENT_ID>",\n        "eventCode":"<EVENT_CODE>",\n        "payload":{\n          "hello":"project"\n        }\n      }\'\n')),(0,r.mdx)("h2",{id:"debugging"},"Debugging"),(0,r.mdx)("p",null,"From the active directory, running the following command will return the logs of the action executed which can help in debugging any issues. "),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},"aio app logs\n")),(0,r.mdx)("h3",{id:"example-debug-logs"},"Example Debug Logs"),(0,r.mdx)(p,{slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"The following code sample does not line wrap. Therefore, you may be required to scroll left and right in order to see the complete logs."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-shell"},'➜  project aio app logs\n__secured_publish-events:cc02982d23234c5a82982d0d1eab1a3f\n2020-06-12T13:11:47.993Z       stdout: 2020-06-12T13:11:47.992Z [main /XXX-{PROJECT_NAME_FROM_CONSOLE}/{PROJECT_NAME_FROM_CONSOLE}-0.0.1/__secured_publish-events] info: Calling the main action\n2020-06-12T13:11:47.994Z       stdout: 2020-06-12T13:11:47.994Z [main /XXX-{PROJECT_NAME_FROM_CONSOLE}/{PROJECT_NAME_FROM_CONSOLE}-0.0.1/__secured_publish-events] debug: {"statusCode":200,"body":{"message":"validation success"},"payload":{"hello":"world"},"__ow_method":"post",...}\n2020-06-12T13:11:48.104Z       stdout: 2020-06-12T13:11:48.104Z [main /XXX-{PROJECT_NAME_FROM_CONSOLE}/{PROJECT_NAME_FROM_CONSOLE}-0.0.1/__secured_publish-events] error: [EventsSDK:ERROR_PUBLISH_EVENT] Error: 403 - Forbidden (https://eventsingress.adobe.io/)\n2020-06-12T13:11:48.104Z       stdout: 2020-06-12T13:11:48.104Z [main /XXX-{PROJECT_NAME_FROM_CONSOLE}/{PROJECT_NAME_FROM_CONSOLE}-0.0.1/__secured_publish-events] info: 500: server error\n')))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-cli-template-generator-cli-md-e4e659c2ae0cbed79b42.js.map