"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[6939],{21504:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return d},default:function(){return p}});var a=t(87462),o=t(63366),i=(t(15007),t(64983)),r=t(91515),s=["components"],d={},l={_frontmatter:d},m=r.Z;function p(e){var n=e.components,t=(0,o.Z)(e,s);return(0,i.mdx)(m,(0,a.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"adobe-io-events-journaling-api"},"Adobe I/O Events Journaling API"),(0,i.mdx)("h2",{id:"what-is-a-journal"},"What is a Journal?"),(0,i.mdx)("p",null,'A Journal, is an ordered list of events - much like a ledger or a log where new entries (events) are added to the end of the ledger and the ledger keeps growing.\nYour application can start reading the ledger from any position and then continue reading "newer" entries (events) in the ledger, much like turning pages forward.'),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"../journaling_intro.md"},"Journaling"),", in contrast to ",(0,i.mdx)("a",{parentName:"p",href:"../index.md"},"webhooks"),", is a ",(0,i.mdx)("em",{parentName:"p"},"pull")," model of consuming events, whereas webhooks are a ",(0,i.mdx)("em",{parentName:"p"},"push")," model.\nIn journaling your application will issue a series of API calls to pull batches of one or more events from the journal.\nThe Journaling API response contains event data and the unique position in the journal for every event returned in that batch."),(0,i.mdx)("p",null,'The position of an event in the journal is significant. For your application to continue reading "newer" events in the journal, the position of the last event needs to be supplied back to the Journaling API in order to fetch events "newer" than the last event.'),(0,i.mdx)("p",null,"A batch of events returned by the Journaling API looks similar to the following JSON object."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n   "events": [ // an ordered list of events\n      {\n         "position": "string", // unique position of this event in the journal\n         "event": {\n            "key": "value" // actual event data\n         }\n      }\n   ],\n   "_page": {\n      "last": "string", // position corresponding to the last event returned in this batch\n      "count": 1 // number of events returned in this batch\n   }\n}\n')),(0,i.mdx)("h2",{id:"fetching-events-from-the-journaling-api"},"Fetching events from the journaling API"),(0,i.mdx)("h3",{id:"finding-the-journaling-endpoint-url"},"Finding the journaling endpoint URL"),(0,i.mdx)("p",null,"Every event registration has a corresponding unique journaling endpoint URL. This URL is displayed on the Adobe Developer Console -"),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("p",{parentName:"li"},"Log into the ",(0,i.mdx)("a",{parentName:"p",href:"/adobe-io-events/console"},"Adobe Developer Console")," and open your project.")),(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("p",{parentName:"li"},"Navigate to the appropriate Event registration using the left sidebar under the Events section.")),(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("p",{parentName:"li"},"Under the Event Delivery Method section, copy the URL for the unique api endpoint.")),(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("p",{parentName:"li"},"Be sure to add the ",(0,i.mdx)("inlineCode",{parentName:"p"},"I/O Management API")," as a service in your integration in order to be able to invoke the journaling API. Click on Add to project > API > I/O Management API."))),(0,i.mdx)("h3",{id:"obtaining-an-access-token-to-call-the-api"},"Obtaining an access token to call the API"),(0,i.mdx)("p",null,"To issue the API call, you need to provide three additional parameters:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Your integration's API key (Client ID). It can be found either on the Project overview page, in the Credentials tab of the Event registration, or on the specific credential page."),(0,i.mdx)("li",{parentName:"ul"},"An OAuth Server-to-Server token. See ",(0,i.mdx)("a",{parentName:"li",href:"/adobe-io-events/developer-console/docs/guides/authentication/ServerToServerAuthentication/#oauth-server-to-server-credential"},"Authentication: Creating an OAuth Server-to-Server Token")," for how to create an OAuth Server-to-Server token."),(0,i.mdx)("li",{parentName:"ul"},"Your organization id in the format ",(0,i.mdx)("inlineCode",{parentName:"li"},"some_id@AdobeOrg"),". This is also displayed in the Overview tab for your integration in the Adobe Developer Console.")),(0,i.mdx)("p",null,"You combine the URL you got from the Journaling section of the event details with your API key, OAuth Server-to-Server token and organization ID to make the call."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/xxxxx/integrations/xxxx/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \\\n  -H "x-ims-org-id: $ORG_ID" \\\n  -H "Authorization: Bearer $oauth_s2s_token" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("h3",{id:"fetching-your-first-batch-of-events-from-the-journal"},"Fetching your first batch of events from the journal"),(0,i.mdx)("p",null,"The journaling endpoint URL, when called without any query parameters fetches the batch of the ",(0,i.mdx)("a",{parentName:"p",href:"#oldest-available-events"},'"oldest" available events'),' in the journal. These events are "older" than all other events and, hence, once your application starts consuming "newer" events from this position it will eventually consume all events present in the journal.'),(0,i.mdx)("p",null,"For example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'HTTP/1.1 200 OK\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614>; rel="next"\n\n{\n   "events":[\n      {\n         "position":"camel:5aeb25cc-1b15-4f26-a082-9c213005dba8:ff244403-ca7c-4993-bbda-3c8915ce0b32",\n         "event":{\n            "@id":"urn:oeid:aem:199e85da-dd54-4966-95ba-13cf544964dc",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-06T15:19:03-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      },\n      {\n         "position":"moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614",\n         "event":{\n            "@id":"urn:oeid:aem:61930ae6-ff2a-48fb-881d-078e862c3811",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-06T15:19:59-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      }\n   ],\n   "_page": {\n      "last": "moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614",\n      "count": 2\n   }\n}\n')),(0,i.mdx)("p",null,(0,i.mdx)("em",{parentName:"p"},"Notice the structure of the JSON response returned by the Journaling API, and that the unique position of every event in the journal is mentioned alongside the event's data.")),(0,i.mdx)("p",null,(0,i.mdx)("em",{parentName:"p"},"Also, for your benefit, all the examples in the journaling documentation are in continuation of each other.")),(0,i.mdx)("h3",{id:"fetching-the-next-batch-of-newer-events-from-the-journal"},'Fetching the next batch of "newer" events from the journal'),(0,i.mdx)("p",null,'Once your application has fetched a batch of events from the journal, it can fetch the next batch of "newer" events by supplying the ',(0,i.mdx)("inlineCode",{parentName:"p"},"position")," of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"last")," event in the current batch. The ",(0,i.mdx)("inlineCode",{parentName:"p"},"position")," of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"last")," event needs to be supplied back in the query parameter ",(0,i.mdx)("inlineCode",{parentName:"p"},"since"),". The API call can then be read semantically as: ",(0,i.mdx)("strong",{parentName:"p"},(0,i.mdx)("inlineCode",{parentName:"strong"},"GET")," a batch of events ",(0,i.mdx)("inlineCode",{parentName:"strong"},"since")," the given ",(0,i.mdx)("inlineCode",{parentName:"strong"},"position")," in the journal.")),(0,i.mdx)("p",null,'Instead of constructing the URL to the next batch of "newer" events it is ',(0,i.mdx)("strong",{parentName:"p"},"strongly recommended")," that you utilize the link provided in the response headers. Every successful response from the journaling API contains a ",(0,i.mdx)("inlineCode",{parentName:"p"},"Link")," response header with the relation type ",(0,i.mdx)("inlineCode",{parentName:"p"},"rel=next"),". The URL in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"next")," link is pre-populated with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"since"),' query parameter to fetch the next batch of "newer" events.'),(0,i.mdx)("p",null,"For example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614 \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'HTTP/1.1 200 OK\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=rabbit:f9645ec8-34f2-4188-bf6e-cea4b2784fda:7dd9e3c4-0d3f-42d5-abb4-1776e209b080>; rel="next"\n\n{\n   "events":[\n      {\n         "position":"rabbit:f9645ec8-34f2-4188-bf6e-cea4b2784fda:7dd9e3c4-0d3f-42d5-abb4-1776e209b080",\n         "event":{\n            "@id":"urn:oeid:aem:f6851819-5fb7-4232-ad25-f523ae44186c",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-01T17:54:14-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      }\n   ],\n   "_page": {\n      "last": "rabbit:f9645ec8-34f2-4188-bf6e-cea4b2784fda:7dd9e3c4-0d3f-42d5-abb4-1776e209b080",\n      "count": 1\n   }\n}\n')),(0,i.mdx)("p",null,(0,i.mdx)("em",{parentName:"p"},"Notice the link header with the URL to the next batch of events. The query parameter ",(0,i.mdx)("inlineCode",{parentName:"em"},"since")," in the URL has been automatically populated with the position of the ",(0,i.mdx)("inlineCode",{parentName:"em"},"last")," event in the batch.")),(0,i.mdx)("h3",{id:"fetching-events-from-the-end-of-the-journal"},"Fetching events from the end of the journal"),(0,i.mdx)("p",null,'By continuously iterating through the journal and consuming "newer" events, eventually your application will reach the "end" of the journal. The "end" of the journal corresponds to that position of the journal, where there are no "newer" events ',(0,i.mdx)("em",{parentName:"p"},"yet"),'. Hence, if you try to fetch events "newer" than the "end" position, no events will be returned - just a ',(0,i.mdx)("inlineCode",{parentName:"p"},"204 No Content")," response."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=rabbit:f9645ec8-34f2-4188-bf6e-cea4b2784fda:7dd9e3c4-0d3f-42d5-abb4-1776e209b080 \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-http"},'HTTP/1.1 204 No Content\nretry-after: 10\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=rabbit:f9645ec8-34f2-4188-bf6e-cea4b2784fda:7dd9e3c4-0d3f-42d5-abb4-1776e209b080>; rel="next"\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb/validate?since=rabbit:f9645ec8-34f2-4188-bf6e-cea4b2784fda:7dd9e3c4-0d3f-42d5-abb4-1776e209b080>; rel="validate"\n')),(0,i.mdx)("p",null,'However, after some time, depending on the frequency of events in your event registration, "newer" events will be added in near real-time to the end of the journal. These events can then be fetched by calling the same URL that earlier returned a ',(0,i.mdx)("inlineCode",{parentName:"p"},"204 No Content")," response, but this time it will return a ",(0,i.mdx)("inlineCode",{parentName:"p"},"200 OK")," response with a list of events in the response body."),(0,i.mdx)("p",null,"For your benefit whenever you're fetching events ",(0,i.mdx)("inlineCode",{parentName:"p"},"since"),' the "end" position in the journal, the ',(0,i.mdx)("inlineCode",{parentName:"p"},"next")," link in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"204 No Content")," will be the same as the current request URI. Hence, you can always rely on the ",(0,i.mdx)("inlineCode",{parentName:"p"},"next")," link to iterate through the journal. And whenever you receive a ",(0,i.mdx)("inlineCode",{parentName:"p"},"204 No Content")," response you should back off by the number of seconds specified in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"retry-after")," response header before resuming to pull events from the ",(0,i.mdx)("inlineCode",{parentName:"p"},"next")," link."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=rabbit:f9645ec8-34f2-4188-bf6e-cea4b2784fda:7dd9e3c4-0d3f-42d5-abb4-1776e209b080 \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'HTTP/1.1 200 OK\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="next"\n\n{\n   "events":[\n      {\n         "position":"penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb",\n         "event":{\n            "@id":"urn:oeid:aem:5492d8d4-6fca-4d6c-a788-043ec4bf32af",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-01T19:33:11-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      }\n   ],\n   "_page": {\n      "last": "penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb",\n      "count": 1\n   }\n}\n')),(0,i.mdx)("h2",{id:"controlling-the-response"},"Controlling the response"),(0,i.mdx)("h3",{id:"limiting-the-size-of-the-batch"},"Limiting the size of the batch"),(0,i.mdx)("p",null,"When events are created at a high frequency, Journal persists groups of events in its storage units;\nwhen events are created at a lower rate, these storage units will contain only one event."),(0,i.mdx)("p",null,"Hence, depending on the traffic of the events associated with your registration,\nthe number of events returned in a single response batch varies:\na batch of events contains at least one event (if you are not already at the end of the journal),\nbut there is no pre-defined upper limit."),(0,i.mdx)("p",null,"In case you wish to set an upper bound, you can supply the ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," query parameter with the maximum number\nof events that may be returned by the API."),(0,i.mdx)("p",null,"Once a ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," query parameter is supplied, the value of the parameter is retained in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"next")," link as well. Hence, you can continue using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"next")," link as-is, without needing to construct it. The ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," query parameter can also be combined with any other query parameter, just make sure that you pass a positive integer as the value."),(0,i.mdx)("p",null,"For example, here is the same request as before but with the number of events returned limited to just one:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?limit=1 \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'HTTP/1.1 200 OK\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=camel:5aeb25cc-1b15-4f26-a082-9c213005dba8:ff244403-ca7c-4993-bbda-3c8915ce0b32&limit=1>; rel="next"\n\n{\n   "events":[\n      {\n         "position":"camel:5aeb25cc-1b15-4f26-a082-9c213005dba8:ff244403-ca7c-4993-bbda-3c8915ce0b32",\n         "event":{\n            "@id":"urn:oeid:aem:199e85da-dd54-4966-95ba-13cf544964dc",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-06T15:19:03-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      }\n   ],\n   "_page": {\n      "last": "camel:5aeb25cc-1b15-4f26-a082-9c213005dba8:ff244403-ca7c-4993-bbda-3c8915ce0b32",\n      "count": 1\n   }\n}\n')),(0,i.mdx)("p",null,"NOTE: The ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," query parameter DOES NOT guarantee that the number of events returned will always be equal to the value supplied.\nThis is true even if there are more events to be consumed in the journal.\nThe ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," query parameter only serves as a way to specify an upper bound on the count of events."),(0,i.mdx)("p",null,"For example, our journal above has at least 4 events that we know of, however, even when the ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," parameter is supplied with the value ",(0,i.mdx)("inlineCode",{parentName:"p"},"3"),", we do not get that many events in the respsonse."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?limit=3 \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'HTTP/1.1 200 OK\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614&limit=3>; rel="next"\n\n{\n   "events":[\n      {\n         "position":"camel:5aeb25cc-1b15-4f26-a082-9c213005dba8:ff244403-ca7c-4993-bbda-3c8915ce0b32",\n         "event":{\n            "@id":"urn:oeid:aem:199e85da-dd54-4966-95ba-13cf544964dc",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-06T15:19:03-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      },\n      {\n         "position":"moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614",\n         "event":{\n            "@id":"urn:oeid:aem:61930ae6-ff2a-48fb-881d-078e862c3811",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-06T15:19:59-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      }\n   ],\n   "_page": {\n      "last": "moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614",\n      "count": 2\n   }\n}\n')),(0,i.mdx)("h3",{id:"consuming-the-most-recent-events"},"Consuming the most recent events"),(0,i.mdx)("p",null,'The Journaling endpoint URL when supplied with no query parameters returns the oldest entries in ledger, however, sometimes a client application is not interested in consuming older events. In such a case, the client application can jump straight to the "end" of the journal and start consuming events that are written to the journal after the request was made.'),(0,i.mdx)("p",null,"This can be done by specifying the query parameter ",(0,i.mdx)("inlineCode",{parentName:"p"},"latest=true")," on the first API call. For example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?latest=true \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-http"},'HTTP/1.1 204 No Content\nretry-after: 10\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="next"\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb/validate?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="validate"\n')),(0,i.mdx)("p",null,"In most cases, there will not be any events to consume yet and the response will be a ",(0,i.mdx)("inlineCode",{parentName:"p"},"204 No Content")," response. In an extremely rare case, there might actually be events that were written in near-real time to the journal after the request was made and in such a case they will be able returned with a ",(0,i.mdx)("inlineCode",{parentName:"p"},"200 OK")," response with the same response body structure as above."),(0,i.mdx)("p",null,"NOTE: the ",(0,i.mdx)("inlineCode",{parentName:"p"},"latest=true"),' query parameter is just a way to jump to the "end" of the journal. The client applications should use the ',(0,i.mdx)("inlineCode",{parentName:"p"},"next")," links as usual to iterate over the journal from that position onward. In case the client application continues to make requests with ",(0,i.mdx)("inlineCode",{parentName:"p"},"latest=true"),', it is very likely that they will not receive any events - just because doing that is semantically equivalent of asking for "events from now onward". And the definition of "now" changes with every request that is made.'),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  /events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-http"},'HTTP/1.1 204 No Content\nretry-after: 10\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="next"\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb/validate?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="validate"\n')),(0,i.mdx)("p",null,"Note: We picked up the ",(0,i.mdx)("inlineCode",{parentName:"p"},"next")," link and made a ",(0,i.mdx)("inlineCode",{parentName:"p"},"GET")," request to the link instead of using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"latest=true")," query parameter again. Once an event is actually available, the same link would give a ",(0,i.mdx)("inlineCode",{parentName:"p"},"200 OK")," response with the event."),(0,i.mdx)("p",null,"Also note that the ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," query parameter can be combined with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"latest")," query parameter as well. Even though the ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," query parameter might not be needed for the first request but it is helpful because subsequent ",(0,i.mdx)("inlineCode",{parentName:"p"},"next")," links will then come with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"limit")," parameter already populated."),(0,i.mdx)("h2",{id:"event-expiry"},"Event expiry"),(0,i.mdx)("p",null,'A journal will retain the events for up to 7 days of them being written. In the running analogy of a ledger, newer entries are added to the "end" whereas entries older than 7 days are removed from the "beginning" of the ledger.'),(0,i.mdx)("h3",{id:"oldest-available-events"},"Oldest available events"),(0,i.mdx)("p",null,"The journaling endpoint URL when called without any query parameters tries to fetch the oldest events in the journal. However, because older events expire after 7 days, the best the API can do is to return the ",(0,i.mdx)("em",{parentName:"p"},"oldest available events")," in the journal."),(0,i.mdx)("p",null,"Hence, over time the response of the Journaling API when called without any query parameters will change. This is only because as older events expire, the starting position of the journal begins pointing to a new set of oldest available events."),(0,i.mdx)("p",null,"For example, let's assume that the first three events in our journal got older than 7 days and have now expired. If we now try to fetch the oldest available events from the journal:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'HTTP/1.1 200 OK\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="next"\n\n{\n   "events":[\n      {\n         "position":"penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb",\n         "event":{\n            "@id":"urn:oeid:aem:5492d8d4-6fca-4d6c-a788-043ec4bf32af",\n            "@type":"xdmCreated",\n            "activitystreams:published":"2018-03-01T19:33:11-08",\n            "activitystreams:to":{\n               "@type":"xdmImsOrg",\n               "xdmImsOrg:id":"01DC1FC45956A5810A494138@AdobeOrg"\n            },\n            "activitystreams:generator":{\n               "@type":"xdmContentRepository",\n               "xdmContentRepository:root":"http://localhost-roberto-aem63:4502"\n            },\n            "activitystreams:actor":{\n               "@id":"healthcheck-user",\n               "@type":"xdmAemUser"\n            },\n            "activitystreams:object":{\n               "@type":"xdmAsset",\n               "xdmAsset:asset_name":"healthcheck.png",\n               "xdmAsset:path":"/content/dam/healthcheck.png",\n               "xdmAsset:format":"image/png"\n            },\n            "xdmEventEnvelope:objectType":"xdmAsset"\n         }\n      }\n   ],\n   "_page": {\n      "last": "penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb",\n      "count": 1\n   }\n}\n')),(0,i.mdx)("h3",{id:"fetching-expired-events"},"Fetching expired events"),(0,i.mdx)("p",null,"Once an event expires, it cannot be fetched again. This means that a request that previously returned events with a ",(0,i.mdx)("inlineCode",{parentName:"p"},"200 OK")," response, after 7 days will stop returning those events, and will instead return a ",(0,i.mdx)("inlineCode",{parentName:"p"},"410 Gone")," response."),(0,i.mdx)("p",null,"For example, now that the first three events in our journal have expired, if we again try to make the second API request in the documentation above, this is the response we will get:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614 \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-http"},"HTTP/1.1 410 Gone\n\nEvents at position moose:e7ba778b-dace-4994-96e7-da80e7125233:2159b72c-e284-4899-b572-08da250e3614 have expired.\n")),(0,i.mdx)("p",null,"Once the events at a certain position have expired, that position in the journal can no longer be used to fetch more events. In such a scenario, your application will need to reset its position in the journal. To reset the position you could chose to consume events from the ",(0,i.mdx)("inlineCode",{parentName:"p"},"oldest available position")," or the ",(0,i.mdx)("inlineCode",{parentName:"p"},"latest")," position depending on your use case."),(0,i.mdx)("h3",{id:"no-events-in-journal"},"No Events in Journal"),(0,i.mdx)("p",null,"If the Journaling API, when called without any query parameters, responds with a ",(0,i.mdx)("inlineCode",{parentName:"p"},"204 No Content")," response it signifies that there aren't actually any events in the journal. Either there may have been events in the past that have now expired, or, there never were any events in the journal."),(0,i.mdx)("p",null,"For example, once all events in our journal expire:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},'curl -X GET \\\n  https://events.adobe.io/events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb \\\n  -H "x-ims-org-id: 4CC7D9704674CFB2138A2C54@AdobeOrg" \\\n  -H "Authorization: Bearer $USER_TOKEN" \\\n  -H "x-api-key: $API_KEY"\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-http"},'HTTP/1.1 204 No Content\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="next"\nLink: </events/organizations/23294/integrations/54108/f89067f2-0d50-4bb2-bf78-209d0eacb6eb/validate?since=penguin:41322b44-c2e9-4b44-8354-ba2173064d24:752f6e67-d7e4-48d3-9f51-452936268fbb>; rel="validate"\n')))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-api-journaling-api-md-63cadd38f3967071d91b.js.map